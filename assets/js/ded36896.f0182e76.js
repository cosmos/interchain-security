"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7429],{2030:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});var o=i(5893),s=i(1151);const t={sidebar_position:2,title:"Pause validator unbonding during equivocation proposal"},a="ADR 007: Pause validator unbonding during equivocation proposal",r={id:"adrs/adr-007-pause-unbonding-on-eqv-prop",title:"Pause validator unbonding during equivocation proposal",description:"Changelog",source:"@site/docs/adrs/adr-007-pause-unbonding-on-eqv-prop.md",sourceDirName:"adrs",slug:"/adrs/adr-007-pause-unbonding-on-eqv-prop",permalink:"/interchain-security/adrs/adr-007-pause-unbonding-on-eqv-prop",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Pause validator unbonding during equivocation proposal"},sidebar:"tutorialSidebar",previous:{title:"Denom DOS fixes",permalink:"/interchain-security/adrs/adr-004-denom-dos-fixes"},next:{title:"Key Assignment",permalink:"/interchain-security/adrs/adr-001-key-assignment"}},d={},c=[{value:"Changelog",id:"changelog",level:2},{value:"Status",id:"status",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"How",id:"how",level:3},{value:"When pause",id:"when-pause",level:3},{value:"When unpause",id:"when-unpause",level:3},{value:"Consequences",id:"consequences",level:2},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3},{value:"References",id:"references",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"adr-007-pause-validator-unbonding-during-equivocation-proposal",children:"ADR 007: Pause validator unbonding during equivocation proposal"}),"\n",(0,o.jsx)(n.h2,{id:"changelog",children:"Changelog"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"2023-05-16: Initial Draft"}),"\n",(0,o.jsx)(n.li,{children:"2023-11-30: Change the status to rejected"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"status",children:"Status"}),"\n",(0,o.jsx)(n.p,{children:"Rejected"}),"\n",(0,o.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note:"})," ADR rejected as the equivocation proposal was removed by the\ncryptographic verification of equivocation feature\n(see ",(0,o.jsx)(n.a,{href:"/interchain-security/adrs/adr-005-cryptographic-equivocation-verification",children:"ADR-005"})," and\n",(0,o.jsx)(n.a,{href:"/interchain-security/adrs/adr-013-equivocation-slashing",children:"ADR-013"}),")."]}),"\n",(0,o.jsx)(n.p,{children:"Currently, if an equivocation slashing proposal is created after more than one\nweek has passed since the equivocation, it is possible that the validator in\nquestion could unbond and get away without being slashed, since the unbonding\nperiod is 3 weeks, and the voting period is 2 weeks. For this reason, it might\nbe good to pause unbondings for validators named in an equivocation slashing\nproposal until the proposal's voting period is over."}),"\n",(0,o.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,o.jsx)(n.h3,{id:"how",children:"How"}),"\n",(0,o.jsxs)(n.p,{children:["Pausing the unbonding period is already possible thanks to the changes in the\n",(0,o.jsx)(n.code,{children:"staking"})," module of the cosmos-sdk:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"stakingKeeper.PutUnbondingOnHold"})," pauses an unbonding period"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"stakingKeeper.UnbondingCanComplete"})," unpauses an unbonding period"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["These methods use a reference counter under the hood, that gets incremented\nevery time ",(0,o.jsx)(n.code,{children:"PutUnbondingOnHold"})," is called, and decreased when\n",(0,o.jsx)(n.code,{children:"UnbondingCanComplete"})," is called instead. A specific unbonding is considered\nfully unpaused when its underlying reference counter reaches 0. Therefore, as\nlong as we safeguard consistency - i.e. we make sure we eventually decrement\nthe reference counter for each time we have incremented it - we can safely use\nthis existing mechanism without conflicts with the ",(0,o.jsx)(n.em,{children:"Completion of Unbonding\nOperations"})," system."]}),"\n",(0,o.jsx)(n.h3,{id:"when-pause",children:"When pause"}),"\n",(0,o.jsxs)(n.p,{children:["The unbonding period (if there is any unbonding) should be paused once an\nequivocation proposal enters the voting period. For that, the ",(0,o.jsx)(n.code,{children:"gov"})," module's\nhook ",(0,o.jsx)(n.code,{children:"AfterProposalDeposit"})," can be used."]}),"\n",(0,o.jsx)(n.p,{children:"If the hook is triggered with a an equivocation proposal in voting period, then\nfor each equivocation of the proposal, the unbonding operations of the related\nvalidator that were initiated after the equivocation block time must be paused"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"i.e. the underlying reference counter has to be increased."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Note that even after the voting period has started, a proposal can receive\nadditional deposits. The hook is triggered however at arrival of a deposit, so\na check to verify that the proposal is not already in voting period is\nrequired."}),"\n",(0,o.jsx)(n.h3,{id:"when-unpause",children:"When unpause"}),"\n",(0,o.jsxs)(n.p,{children:["We can use a ",(0,o.jsx)(n.code,{children:"gov"})," module's hook also here and it is\n",(0,o.jsx)(n.code,{children:"AfterProposalVotingPeriodEnded"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"If the hook is triggered with an equivocation proposal, then for each\nassociated equivocation, the unbonding operations of the related validator that\nwere initiated between the equivocation block time and the start of the\nproposal voting period must be unpaused - i.e. decrease the underlying\nreference counter - regardless of the proposal outcome."}),"\n",(0,o.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,o.jsx)(n.h3,{id:"positive",children:"Positive"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Validators subject to an equivocation proposal cannot finish unbonding\ntheir tokens before the end of the voting period."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"negative",children:"Negative"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"A malicious consumer chain could forge slash packets enabling submission of\nan equivocation proposal on the provider chain, resulting in the freezing of\nvalidator's unbondings for an undeterminated amount of time."}),"\n",(0,o.jsx)(n.li,{children:"Misbehavior on a consumer chain can potentially go unpunished, if no one\nsubmits an equivocation proposal in time, or if the proposal doesn't pass."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"neutral",children:"Neutral"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"This feature can't be used for social slashing, because an equivocation\nproposal is only accepted if there's a slash log for the related\nvalidator(s), meaning the consumer chain has reported the equivocation to\nthe provider chain."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/cosmos/interchain-security/issues/747",children:"https://github.com/cosmos/interchain-security/issues/747"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/cosmos/interchain-security/pull/791",children:"https://github.com/cosmos/interchain-security/pull/791"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>r,a:()=>a});var o=i(7294);const s={},t=o.createContext(s);function a(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);