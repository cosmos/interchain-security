# Test Documentation

| File | Function | Short Description |
|------|----------|-------------------|
| [channel_init.go](../../tests/integration/channel_init.go#L4) | TestInitTimeout | TestInitTimeout tests the init timeout |
| [distribution.go](../../tests/integration/distribution.go#L24) | TestRewardsDistribution | This test is valid for minimal viable consumer chain |
| [distribution.go](../../tests/integration/distribution.go#L187) | TestSendRewardsRetries | TestSendRewardsRetries tests that failed reward transmissions are retried every BlocksPerDistributionTransmission blocks |
| [distribution.go](../../tests/integration/distribution.go#L263) | TestEndBlockRD | TestEndBlockRD tests that the last transmission block height (LTBH) is correctly updated after the expected number of block have passed. It also checks that the IBC transfer transfer states are discarded if the reward distribution to the provider has failed.  Note: this method is effectively a unit test for EndBLockRD(), but is written as an integration test to avoid excessive mocking. |
| [distribution.go](../../tests/integration/distribution.go#L383) | TestSendRewardsToProvider | TestSendRewardsToProvider is effectively a unit test for SendRewardsToProvider(), but is written as an integration test to avoid excessive mocking. |
| [distribution.go](../../tests/integration/distribution.go#L525) | TestIBCTransferMiddleware | TestIBCTransferMiddleware tests the logic of the IBC transfer OnRecvPacket callback |
| [distribution.go](../../tests/integration/distribution.go#L707) | TestAllocateTokens | TestAllocateTokens is a happy-path test of the consumer rewards pool allocation to opted-in validators and the community pool |
| [distribution.go](../../tests/integration/distribution.go#L971) | TestAllocateTokensToConsumerValidatorsWithDifferentValidatorHeights | TestAllocateTokensToConsumerValidatorsWithDifferentValidatorHeights tests `AllocateTokensToConsumerValidators` with consumer validators that have different heights. Specifically, test that validators that have been consumer validators for some time receive rewards, while validators that recently became consumer validators do not receive rewards. |
| [distribution.go](../../tests/integration/distribution.go#L1079) | TestMultiConsumerRewardsDistribution | TestMultiConsumerRewardsDistribution tests the rewards distribution of multiple consumers chains |
| [double_vote.go](../../tests/integration/double_vote.go#L17) | TestHandleConsumerDoubleVoting | TestHandleConsumerDoubleVoting verifies that handling a double voting evidence of a consumer chain results in the expected tombstoning, jailing, and slashing of the misbehaved validator |
| [double_vote.go](../../tests/integration/double_vote.go#L271) | TestHandleConsumerDoubleVotingSlashesUndelegationsAndRelegations | TestHandleConsumerDoubleVotingSlashesUndelegationsAndRelegations verifies that handling a successful double voting evidence of a consumer chain results in the expected slashing of the misbehave validator undelegations |
| [expired_client.go](../../tests/integration/expired_client.go#L23) | TestVSCPacketSendExpiredClient | TestVSCPacketSendWithExpiredClient tests queueing of VSCPackets when the consumer client is expired. While the consumer client is expired (or inactive for some reason) all packets will be queued and and cleared once the consumer client is established. |
| [expired_client.go](../../tests/integration/expired_client.go#L87) | TestConsumerPacketSendExpiredClient | TestConsumerPacketSendExpiredClient tests the consumer sending packets when the provider client is expired. While the provider client is expired  all packets will be queued and and cleared once the provider client is upgraded. |
| [misbehaviour.go](../../tests/integration/misbehaviour.go#L19) | TestHandleConsumerMisbehaviour | TestHandleConsumerMisbehaviour tests that handling a valid misbehaviour, with conflicting headers forming an equivocation, results in the jailing of the validators |
| [normal_operations.go](../../tests/integration/normal_operations.go#L13) | TestHistoricalInfo | Tests the tracking of historical info in the context of new blocks being committed |
| [provider_gov_hooks.go](../../tests/integration/provider_gov_hooks.go#L18) | TestAfterPropSubmissionAndVotingPeriodEnded | tests AfterProposalSubmission and AfterProposalVotingPeriodEnded hooks hooks require adding a proposal in the gov module and registering a consumer chain with the provider module |
| [slashing.go](../../tests/integration/slashing.go#L39) | TestRelayAndApplyDowntimePacket | TestRelayAndApplyDowntimePacket tests that downtime slash packets can be properly relayed from consumer to provider, handled by provider, with a VSC and jailing eventually effective on consumer and provider.  Note: This method does not test the actual slash packet sending logic for downtime and double-signing, see TestValidatorDowntime and TestValidatorDoubleSigning for those types of tests. |
| [slashing.go](../../tests/integration/slashing.go#L177) | TestRelayAndApplyDoubleSignPacket | Similar setup to TestRelayAndApplyDowntimePacket, but with a double sign slash packet. Note that double-sign slash packets should not affect the provider validator set. |
| [slashing.go](../../tests/integration/slashing.go#L302) | TestHandleSlashPacketDowntime | TestHandleSlashPacketDowntime tests the handling of a downtime related slash packet, with integration tests. Note that only downtime slash packets are processed by HandleSlashPacket. |
| [slashing.go](../../tests/integration/slashing.go#L343) | TestOnRecvSlashPacketErrors | TestOnRecvSlashPacketErrors tests errors for the OnRecvSlashPacket method in an integration testing setting |
| [slashing.go](../../tests/integration/slashing.go#L442) | TestValidatorDowntime | TestValidatorDowntime tests if a slash packet is sent and if the outstanding slashing flag is switched when a validator has downtime on the slashing module |
| [slashing.go](../../tests/integration/slashing.go#L555) | TestValidatorDoubleSigning | TestValidatorDoubleSigning tests if a slash packet is sent when a double-signing evidence is handled by the evidence module |
| [slashing.go](../../tests/integration/slashing.go#L642) | TestQueueAndSendSlashPacket | TestQueueAndSendSlashPacket tests the integration of QueueSlashPacket with SendPackets. In normal operation slash packets are queued in BeginBlock and sent in EndBlock. |
| [slashing.go](../../tests/integration/slashing.go#L722) | TestCISBeforeCCVEstablished | TestCISBeforeCCVEstablished tests that the consumer chain doesn't panic or have any undesired behavior when a slash packet is queued before the CCV channel is established. Then once the CCV channel is established, the slash packet should be sent soon after. |
| [stop_consumer.go](../../tests/integration/stop_consumer.go#L14) | TestStopConsumerChain | Tests the functionality of stopping a consumer chain at a higher level than unit tests |
| [stop_consumer.go](../../tests/integration/stop_consumer.go#L99) | TestStopConsumerOnChannelClosed | TODO Simon: implement OnChanCloseConfirm in IBC-GO testing to close the consumer chain's channel end |
| [throttle.go](../../tests/integration/throttle.go#L24) | TestBasicSlashPacketThrottling | TestBasicSlashPacketThrottling tests slash packet throttling with a single consumer, two slash packets, and no VSC matured packets. The most basic scenario. |
| [throttle.go](../../tests/integration/throttle.go#L197) | TestMultiConsumerSlashPacketThrottling | TestMultiConsumerSlashPacketThrottling tests slash packet throttling in the context of multiple consumers sending slash packets to the provider, with VSC matured packets sprinkled around. |
| [throttle.go](../../tests/integration/throttle.go#L319) | TestPacketSpam | TestPacketSpam confirms that the provider can handle a large number of incoming slash packets in a single block. |
| [throttle.go](../../tests/integration/throttle.go#L466) | TestSlashingSmallValidators | TestSlashingSmallValidators tests that multiple slash packets from validators with small power can be handled by the provider chain in a non-throttled manner. |
| [throttle.go](../../tests/integration/throttle.go#L541) | TestSlashMeterAllowanceChanges | TestSlashMeterAllowanceChanges tests scenarios where the slash meter allowance is expected to change.  TODO: This should be a unit test, or replaced by TestTotalVotingPowerChanges. |
| [throttle.go](../../tests/integration/throttle.go#L567) | TestSlashAllValidators | Similar to TestSlashSameValidator, but 100% of val power is jailed a single block, and in the first packets recv for that block. This edge case should not occur in practice, but is useful to validate that the slash meter can allow any number of slash packets to be handled in a single block when its allowance is set to "1.0". |
| [throttle_retry.go](../../tests/integration/throttle_retry.go#L14) | TestSlashRetries | TestSlashRetries tests the throttling v2 retry logic at an integration level. |
| [unbonding.go](../../tests/integration/unbonding.go#L16) | TestUndelegationNormalOperation | TestUndelegationNormalOperation tests that undelegations complete after the unbonding period elapses on both the consumer and provider, without VSC packets timing out. |
| [unbonding.go](../../tests/integration/unbonding.go#L131) | TestUndelegationVscTimeout | TestUndelegationVscTimeout tests that an undelegation completes after vscTimeoutPeriod even if it does not reach maturity on the consumer chain. In this case, the consumer chain is removed. |
| [unbonding.go](../../tests/integration/unbonding.go#L192) | TestUndelegationDuringInit | TestUndelegationDuringInit checks that before the CCV channel is established   - no undelegations can complete, even if the provider unbonding period elapses   - all the VSC packets are stored in state as pending   - if the channel handshake times out, then the undelegation completes |
| [unbonding.go](../../tests/integration/unbonding.go#L304) | TestUnbondingNoConsumer | Bond some tokens on provider Unbond them to create unbonding op Check unbonding ops on both sides Advance time so that provider's unbonding op completes Check that unbonding has completed in provider staking |
| [unbonding.go](../../tests/integration/unbonding.go#L342) | TestRedelegationNoConsumer | TestRedelegationNoConsumer tests a redelegate transaction submitted on a provider chain with no consumers |
| [unbonding.go](../../tests/integration/unbonding.go#L392) | TestRedelegationProviderFirst | TestRedelegationWithConsumer tests a redelegate transaction submitted on a provider chain when the unbonding period elapses first on the provider chain |
| [unbonding.go](../../tests/integration/unbonding.go#L475) | TestTooManyLastValidators | This test reproduces a fixed bug when an inactive validator enters back into the active set. It used to cause a panic in the provider module hook called by AfterUnbondingInitiated during the staking module EndBlock. |
| [valset_update.go](../../tests/integration/valset_update.go#L17) | TestPacketRoundtrip | TestPacketRoundtrip tests a CCV packet roundtrip when tokens are bonded on provider |
| [valset_update.go](../../tests/integration/valset_update.go#L41) | TestQueueAndSendVSCMaturedPackets | TestQueueAndSendVSCMaturedPackets tests the behavior of EndBlock QueueVSCMaturedPackets call and its integration with SendPackets call. |
