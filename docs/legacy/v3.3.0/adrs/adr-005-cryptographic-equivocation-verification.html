<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v3.3.0 plugin-docs plugin-id-default docs-doc-id-adrs/adr-005-cryptographic-equivocation-verification">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Cryptographic verification of equivocation evidence | Interchain Security</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://cosmos.github.io/interchain-security/legacy/img/banner.jpg"><meta data-rh="true" name="twitter:image" content="https://cosmos.github.io/interchain-security/legacy/img/banner.jpg"><meta data-rh="true" property="og:url" content="https://cosmos.github.io/interchain-security/legacy/v3.3.0/adrs/adr-005-cryptographic-equivocation-verification"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v3.3.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v3.3.0"><meta data-rh="true" name="docsearch:version" content="v3.3.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v3.3.0"><meta data-rh="true" property="og:title" content="Cryptographic verification of equivocation evidence | Interchain Security"><meta data-rh="true" name="description" content="Changelog"><meta data-rh="true" property="og:description" content="Changelog"><link data-rh="true" rel="icon" href="/interchain-security/legacy/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://cosmos.github.io/interchain-security/legacy/v3.3.0/adrs/adr-005-cryptographic-equivocation-verification"><link data-rh="true" rel="alternate" href="https://cosmos.github.io/interchain-security/legacy/v3.3.0/adrs/adr-005-cryptographic-equivocation-verification" hreflang="en"><link data-rh="true" rel="alternate" href="https://cosmos.github.io/interchain-security/legacy/v3.3.0/adrs/adr-005-cryptographic-equivocation-verification" hreflang="x-default"><link rel="stylesheet" href="/interchain-security/legacy/assets/css/styles.f695a4a3.css">
<link rel="preload" href="/interchain-security/legacy/assets/js/runtime~main.6dc179b3.js" as="script">
<link rel="preload" href="/interchain-security/legacy/assets/js/main.206ddac4.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/interchain-security/legacy/"><b class="navbar__title text--truncate">Interchain Security</b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/interchain-security/legacy/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/interchain-security/legacy/">Next</a></li><li><a class="dropdown__link" href="/interchain-security/legacy/">v3.3.1-lsm</a></li><li><a class="dropdown__link" href="/interchain-security/legacy/v3.3.0">v3.3.0</a></li><li><a class="dropdown__link" href="/interchain-security/legacy/v3.2.0">v3.2.0</a></li><li><a class="dropdown__link" href="/interchain-security/legacy/v3.1.0">v3.1.0</a></li><li><a class="dropdown__link" href="/interchain-security/legacy/v2.4.0-lsm">v2.4.0-lsm</a></li><li><a class="dropdown__link" href="/interchain-security/legacy/v2.0.0">v2.0.0</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cosmos/interchain-security" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="github-icon">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 0.300049C5.4 0.300049 0 5.70005 0 12.3001C0 17.6001 3.4 22.1001 8.2 23.7001C8.8 23.8001 9 23.4001 9 23.1001C9 22.8001 9 22.1001 9 21.1001C5.7 21.8001 5 19.5001 5 19.5001C4.5 18.1001 3.7 17.7001 3.7 17.7001C2.5 17.0001 3.7 17.0001 3.7 17.0001C4.9 17.1001 5.5 18.2001 5.5 18.2001C6.6 20.0001 8.3 19.5001 9 19.2001C9.1 18.4001 9.4 17.9001 9.8 17.6001C7.1 17.3001 4.3 16.3001 4.3 11.7001C4.3 10.4001 4.8 9.30005 5.5 8.50005C5.5 8.10005 5 6.90005 5.7 5.30005C5.7 5.30005 6.7 5.00005 9 6.50005C10 6.20005 11 6.10005 12 6.10005C13 6.10005 14 6.20005 15 6.50005C17.3 4.90005 18.3 5.30005 18.3 5.30005C19 7.00005 18.5 8.20005 18.4 8.50005C19.2 9.30005 19.6 10.4001 19.6 11.7001C19.6 16.3001 16.8 17.3001 14.1 17.6001C14.5 18.0001 14.9 18.7001 14.9 19.8001C14.9 21.4001 14.9 22.7001 14.9 23.1001C14.9 23.4001 15.1 23.8001 15.7 23.7001C20.5 22.1001 23.9 17.6001 23.9 12.3001C24 5.70005 18.6 0.300049 12 0.300049Z" fill="currentColor"/>
            </svg>
            </a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/interchain-security/legacy/v3.3.0">Interchain Security Docs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/interchain-security/legacy/v3.3.0/introduction/overview">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/interchain-security/legacy/v3.3.0/features/key-assignment">Features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/interchain-security/legacy/v3.3.0/consumer-development/app-integration">Consumer Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/interchain-security/legacy/v3.3.0/validators/overview">Validators Guide</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/interchain-security/legacy/v3.3.0/faq">Frequently Asked Questions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/interchain-security/legacy/v3.3.0/adrs/intro">ADRs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/intro">ADRs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-007-pause-unbonding-on-eqv-prop">ADR Template</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-template">ADR Template</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-001-key-assignment">Key Assignment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-002-throttle">Jail Throttling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-003-equivocation-gov-proposal">Equivocation governance proposal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-005-cryptographic-equivocation-verification">Cryptographic verification of equivocation evidence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-008-throttle-retries">Throttle with retries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-009-soft-opt-out">Soft Opt-Out</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-010-standalone-changeover">Standalone to Consumer Changeover</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-011-improving-test-confidence">Improving testing and increasing confidence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-012-separate-releasing">Separate Releasing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interchain-security/legacy/v3.3.0/adrs/adr-013-equivocation-slashing">Slashing on the provider for consumer equivocation</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Interchain Security<!-- --> <b>v3.3.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/interchain-security/legacy/">latest version</a></b> (<!-- -->v3.3.1-lsm<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/interchain-security/legacy/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ADRs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Cryptographic verification of equivocation evidence</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v3.3.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>ADR 005: Cryptographic verification of equivocation evidence</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">Changelog<a href="#changelog" class="hash-link" aria-label="Direct link to Changelog" title="Direct link to Changelog">​</a></h2><ul><li>5/1/2023: First draft</li><li>7/23/2023: Add light client attacks handling</li><li>9/6/2023: Add double signing attacks handling</li><li>11/3/2023: Update limitations to clarify amnesia attacks are ignored</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="status">Status<a href="#status" class="hash-link" aria-label="Direct link to Status" title="Direct link to Status">​</a></h2><p>Accepted</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context">​</a></h2><p>Currently, we use a governance proposal to slash validators for equivocation (double signing and light client attacks).
Every proposal needs to go through a (two weeks) voting period before it can be approved.
Given a three-week unbonding period, this means that an equivocation proposal needs to be submitted within one week since the infraction occurred.</p><p>This ADR proposes a system to slash validators automatically for equivocation, immediately upon the provider chain&#x27;s receipt of the evidence. Another thing to note is that we intend to introduce this system in stages, since even the partial ability to slash and/or tombstone is a strict improvement in security.
The feature is implemented in two parts, each with its dedicated endpoint. One endpoint handles light client attacks, while the other handles double signing attacks.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="light-client-attack">Light Client Attack<a href="#light-client-attack" class="hash-link" aria-label="Direct link to Light Client Attack" title="Direct link to Light Client Attack">​</a></h3><p>In a nutshell, the light client is a process that solely verifies a specific state machine&#x27;s
consensus without executing the transactions. The light clients get new headers by querying
multiple nodes, called primary and witness nodes. </p><p>Light clients download new headers committed on chain from a primary. Headers can be verified in two ways: sequentially,
where the block height of headers is serial, or using skipping. This second verification method allows light clients to download headers
with nonconsecutive block height, where some intermediate headers are skipped (see <a href="https://arxiv.org/pdf/2010.07031.pdf" target="_blank" rel="noopener noreferrer">Tendermint Light Client, Figure 1 and Figure 3</a>).
Additionally, light clients are cross-checking new headers obtained from a primary with witnesses to ensure all nodes share the same state.</p><p>A light client attack occurs when a Byzantine validator sends invalid headers to a light client.
As the light client doesn&#x27;t execute transactions, it can be deceived into trusting corrupted application state transitions.
For instance, if a light client receives header <code>A</code> from the primary and header <code>B</code> from a witness for the same block height <code>H</code>,
and both headers are successfully verified, it indicates a light client attack.
Note that in this case, either the primary or the witness or both are malicious.</p><p>The types of light client attacks are defined by analyzing the differences between the conflicting headers.
There are three types of light client attacks: lunatic attack, equivocation attack, and amnesia attack.
For details, see the <a href="https://github.com/cometbft/cometbft/blob/main/spec/light-client/attacks/notes-on-evidence-handling.md#evidence-handling" target="_blank" rel="noopener noreferrer">CometBFT specification</a>.</p><p>When a light client agent detects two conflicting headers, it will initially verify their traces (see <a href="https://github.com/cometbft/cometbft/blob/v0.34.28/light/detector.go#L28" target="_blank" rel="noopener noreferrer">cometBFT detector</a>) using its primary and witness nodes.
If these headers pass successful verification, the Byzantine validators will be identified based on the header&#x27;s commit signatures
and the type of light client attack. The agent will then transmit this information to its nodes using a <a href="https://github.com/cometbft/cometbft/blob/v0.34.28/spec/consensus/evidence.md#light-client-attacks" target="_blank" rel="noopener noreferrer"><code>LightClientAttackEvidence</code></a> evidence to be eventually voted on and added to a block.
Note that from a light client agent perspective, it is not possible to establish whether a primary or a witness node, or both, are malicious.
Therefore, it will create and send two evidences: one against the primary (sent to the witness), and one against the witness (sent to the primary).
Both nodes will then verify it before broadcasting it and adding it to the <a href="https://github.com/cometbft/cometbft/blob/v0.34.28/evidence/pool.go#L28" target="_blank" rel="noopener noreferrer">evidence pool</a>.
If an evidence is finally committed to a block, the chain&#x27;s evidence module will execute it, resulting in the jailing and the slashing of the validators responsible for the light client attack.</p><p>Light clients are a core component of IBC. In the event of a light client attack, IBC relayers notify the affected chains by submitting an <a href="https://github.com/cosmos/ibc-go/blob/v4.4.2/proto/ibc/lightclients/tendermint/v1/tendermint.proto#L79" target="_blank" rel="noopener noreferrer">IBC misbehavior message</a>.
A misbehavior message includes the conflicting headers that constitute a light client attack evidence. Upon receiving such a message,
a chain will first verify whether these headers would have convinced its light client. This verification is achieved by checking
the header states against the light client consensus states (see <a href="https://github.com/cosmos/ibc-go/blob/v4.4.2/modules/light-clients/07-tendermint/types/misbehaviour_handle.go#L24" target="_blank" rel="noopener noreferrer">IBC misbehaviour handler</a>). If the misbehaviour is successfully verified, the chain will then &quot;freeze&quot; the
light client, halting any further trust in or updating of its states.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="double-signing-attack">Double Signing Attack<a href="#double-signing-attack" class="hash-link" aria-label="Direct link to Double Signing Attack" title="Direct link to Double Signing Attack">​</a></h3><p>A double signing attack, also known as equivocation,
occurs when a validator votes for two different blocks in the same round of the CometBFT consensus.
This consensus mechanism operates with multiple voting rounds at each block height,
and it strictly prohibits sending two votes of the same type during a round
(see <a href="https://github.com/cometbft/cometbft/blob/v0.34.28/spec/consensus/consensus.md#state-machine-overview" target="_blank" rel="noopener noreferrer">CometBFT State Machine Overview</a>).</p><p>When a node observes two votes from the same peer, it will use these two votes to create
a <a href="https://github.com/cometbft/cometbft/blob/v0.34.28/types/evidence.go#L35" target="_blank" rel="noopener noreferrer"><code>DuplicateVoteEvidence</code></a>
evidence and gossip it to the other nodes in the network
(see <a href="https://github.com/cometbft/cometbft/blob/v0.34.28/spec/consensus/evidence.md#detection" target="_blank" rel="noopener noreferrer">CometBFT equivocation detection</a>).
Each node will then verify the evidence according to the CometBFT rules that define a valid double signing infraction, and based on this verification, they will decide whether to add the evidence to a block.
During the evidence verification process, the signatures of the conflicting votes must be verified successfully.
Note that this is achieved using the public key of the misbehaving validator, along with the chain ID of the chain where the infraction occurred (see <a href="https://github.com/cometbft/cometbft/blob/v0.34.28/spec/consensus/evidence.md#verification" target="_blank" rel="noopener noreferrer">CometBFT equivocation verification</a>).</p><p>Once a double signing evidence is committed to a block, the consensus layer will report the equivocation to the evidence module of the Cosmos SDK application layer.
The application will, in turn, punish the malicious validator through jailing, tombstoning and slashing
(see <a href="https://github.com/cosmos/cosmos-sdk/blob/v0.45.16-ics-lsm/x/evidence/keeper/infraction.go#L263" target="_blank" rel="noopener noreferrer">handleEquivocationEvidence</a>).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision">Decision<a href="#decision" class="hash-link" aria-label="Direct link to Decision" title="Direct link to Decision">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="light-client-attack-1">Light Client Attack<a href="#light-client-attack-1" class="hash-link" aria-label="Direct link to Light Client Attack" title="Direct link to Light Client Attack">​</a></h3><p>In the first part of the feature, we introduce a new endpoint: <code>HandleConsumerMisbehaviour(ctx sdk.Context, misbehaviour ibctmtypes.Misbehaviour)</code>.
The main idea is to leverage the current IBC misbehaviour handling and update it to solely jail and slash the validators that
performed a light client attack. Note that in this context, we assume that chains connected via a light client
share the same validator set, as is the case with Replicated Security. </p><p>This endpoint reuses the IBC client libraries to verify that the misbehaviour headers would have fooled the light client.
Additionally, it’s crucial that the endpoint logic results in the slashing and jailing of validators under the same conditions
as a light client agent detector. Therefore, the endpoint ensures that the two conditions are met:
the headers in the misbehaviour message have the same block height, and
the light client isn’t expired.</p><p>After having successfully verified a misbehaviour, the endpoint executes the jailing and slashing of the malicious validators similarly as in the evidence module. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="double-signing-attack-1">Double Signing Attack<a href="#double-signing-attack-1" class="hash-link" aria-label="Direct link to Double Signing Attack" title="Direct link to Double Signing Attack">​</a></h3><p>In the second part of the feature, we introduce a new endpoint <code>HandleConsumerDoubleVoting(
ctx sdk.Context, evidence *tmtypes.DuplicateVoteEvidence, chainID string, pubkey cryptotypes.PubKey)</code>.
Simply put, the handling logic verifies a double signing evidence against a provided
public key and chain ID and, if successful, executes the jailing of the malicious validator who double voted.</p><p>We define a new
<code>MsgSubmitConsumerDoubleVoting</code> message to report a double voting evidence observed
on a consumer chain to the endpoint of the provider chain. This message contains two fields:
a double signing evidence
<code>duplicate_vote_evidence</code> and a light client header for the infraction block height,
referred to as <code>infraction_block_header</code>.
The latter provides the malicious validator&#x27;s public key and the chain ID required to verify the signature of the votes contained in the evidence.</p><p>Note that double signing evidence is not verified using the same conditions as in the implementation CometBFT (see
<a href="https://github.com/cometbft/cometbft/blob/v0.34.28/evidence/verify.go#L19" target="_blank" rel="noopener noreferrer"><code>verify(evidence types.Evidence)</code></a> method). Specifically, we do not check that the evidence hasn&#x27;t expired.
More details can be found in the <a href="#current-limitations">&quot;Current limitations&quot;</a> section below. </p><p>Upon a successful equivocation verification, the misbehaving validator is jailed for the maximum time
(see <a href="https://github.com/cosmos/cosmos-sdk/blob/v0.45.16-ics-lsm/x/evidence/types/params.go#L11" target="_blank" rel="noopener noreferrer">DoubleSignJailEndTime</a>
in the SDK evidence module).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="current-limitations">Current limitations:<a href="#current-limitations" class="hash-link" aria-label="Direct link to Current limitations:" title="Direct link to Current limitations:">​</a></h3><ul><li><p>We cannot derive an infraction height from the evidence, so it is only possible to jail validators, not actually slash them.
To explain the technical reasons behind this limitation, let&#x27;s recap the initial consumer initiated slashing logic.
In a nutshell, consumer heights are mapped to provider heights through VSCPackets, namely through the so called vscIDs.
When an infraction occurs on the consumer, a SlashPacket containing the vscID obtained from mapping the consumer infraction height
is sent to the provider. Upon receiving the packet, the provider maps the consumer infraction height to a local infraction height,
which is used to slash the misbehaving validator. In the context of untrusted consumer chains, all their states, including vscIDs,
could be corrupted and therefore cannot be used for slashing purposes.</p></li><li><p>For the same reasons explained above, the age of a consumer double signing evidence can&#x27;t be verified,
either using its infraction height or its unsigned timestamp. Note that changes the jailing behaviour, potentially leading to a validator&#x27;s jailing based on some &quot;old&quot; evidence from a consumer, which wouldn&#x27;t occur if the consumer were a standalone chain.</p></li><li><p>In the first stage of this feature, validators are jailed indefinitely without being tombstoned.
The underlying reason is that a malicious validator could take advantage of getting tombstoned
to avoid being slashed on the provider (<a href="https://github.com/cosmos/interchain-security/pull/1232#issuecomment-1693127641" target="_blank" rel="noopener noreferrer">see comment</a>). </p></li><li><p>Currently, the endpoint can only handle <em>equivocation</em> light client attacks. This is because the <em>lunatic</em> attacks require the endpoint to possess the ability to dissociate which header is conflicted or trusted upon receiving a misbehavior message. Without this information, it&#x27;s not possible to extract the Byzantine validators from the conflicting headers (see <a href="https://github.com/cosmos/interchain-security/pull/826#discussion_r1268668684" target="_blank" rel="noopener noreferrer">comment</a>). In addition, &quot;amnesia&quot; attacks are ignored, similar to CometBFT (see <a href="https://github.com/cometbft/cometbft/blob/main/docs/architecture/tendermint-core/adr-056-light-client-amnesia-attacks.md#decision" target="_blank" rel="noopener noreferrer">ADR-056</a>).</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consequences">Consequences<a href="#consequences" class="hash-link" aria-label="Direct link to Consequences" title="Direct link to Consequences">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="positive">Positive<a href="#positive" class="hash-link" aria-label="Direct link to Positive" title="Direct link to Positive">​</a></h3><ul><li>It is now possible for the provider chain to jail validators who committed
light client or double signing attacks on a consumer chain.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="negative">Negative<a href="#negative" class="hash-link" aria-label="Direct link to Negative" title="Direct link to Negative">​</a></h3><ul><li>N/A</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ul><li><a href="https://github.com/cosmos/interchain-security/pull/826" target="_blank" rel="noopener noreferrer">ICS misbehaviour handling PR</a></li><li><a href="https://github.com/cosmos/interchain-security/pull/1232" target="_blank" rel="noopener noreferrer">Consumer double voting handler PR</a></li><li><a href="https://docs.google.com/document/d/1fe1uSJl1ZIYWXoME3Yf4Aodvz7V597Ric875JH-rigM/edit#heading=h.rv4t8i6d6jfn" target="_blank" rel="noopener noreferrer">Architectural diagrams</a></li><li><a href="https://github.com/cosmos/interchain-security/blob/main/docs/docs/adrs/adr-013-equivocation-slashing.md" target="_blank" rel="noopener noreferrer">ADR on equivocation slashing</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/interchain-security/legacy/v3.3.0/adrs/adr-003-equivocation-gov-proposal"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Equivocation governance proposal</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/interchain-security/legacy/v3.3.0/adrs/adr-008-throttle-retries"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Throttle with retries</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#changelog" class="table-of-contents__link toc-highlight">Changelog</a></li><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a><ul><li><a href="#light-client-attack" class="table-of-contents__link toc-highlight">Light Client Attack</a></li><li><a href="#double-signing-attack" class="table-of-contents__link toc-highlight">Double Signing Attack</a></li></ul></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a><ul><li><a href="#light-client-attack-1" class="table-of-contents__link toc-highlight">Light Client Attack</a></li><li><a href="#double-signing-attack-1" class="table-of-contents__link toc-highlight">Double Signing Attack</a></li><li><a href="#current-limitations" class="table-of-contents__link toc-highlight">Current limitations:</a></li></ul></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a><ul><li><a href="#positive" class="table-of-contents__link toc-highlight">Positive</a></li><li><a href="#negative" class="table-of-contents__link toc-highlight">Negative</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cosmos.network"><img src="/img/logo-bw.svg" alt="Cosmos Logo"></a></li></ul></div><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://hub.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmos Hub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmos SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.tendermint.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tendermint Core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ibc.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBC Go<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/cosmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://reddit.com/r/cosmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/cosmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/cosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/c/CosmosProject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/cosmosproject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Informal Systems</div></div></div></footer></div>
<script src="/interchain-security/legacy/assets/js/runtime~main.6dc179b3.js"></script>
<script src="/interchain-security/legacy/assets/js/main.206ddac4.js"></script>
</body>
</html>